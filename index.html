<html>

<head>
    <title>Advent of Code Explorer</title>
    <style>
        table {
            width: 100%;
        }

        textarea {
            width: 100%;
            height: 500px;
            resize: none;
        }
    </style>
</head>

<body>
    <form id="aoc-search">
        <label for="aoc-year">Year: <select name="year" id="aoc-year"></select></label><br />
        <label for="aoc-day">Day: <select name="day" id="aoc-day"></select></label><br />
        <input type="submit" value="Search">
    </form>

    <div class="aoc-info">
        <h1>Advent of Code - Year <span id="aoc-year-display">N/A</span>, Day <span id="aoc-day-display">N/A</span></h1>
        <h2>View the code: </h2>
        <p id="aoc-story-display"></p>
        <table>
            <tr>
                <th>
                    <textarea id="aoc-part1-display" readonly></textarea>
                </th>
                <th>
                    <textarea id="aoc-part2-display" readonly></textarea>
                </th>
            </tr>
        </table>
    </div>

    <div class="aoc-testing">
        <h2>Test your inputs: </h2>
        <p>Answer for Part 1: <span id="aoc-part1-answer">N/A</span></p>
        <p>Answer for Part 2: <span id="aoc-part2-answer">N/A</span></p>
        <button id="aoc-run">Run with input</button>
        <textarea id="aoc-input"></textarea>
    </div>
    
    <script>
        const loadFile = async file => {
            let response = await fetch(file);
            let text = await response.text();
            return text;
        }

        const loadPage = (year, day) => {
            document.querySelector('#aoc-year-display').innerHTML = year;
            document.querySelector('#aoc-day-display').innerHTML = day;

            loadFile(`../years/${year}/day${day}/part1.js`)
                .then(text => {
                    document.querySelector('#aoc-part1-display').innerHTML = text;
                });

            loadFile(`../years/${year}/day${day}/part2.js`)
                .then(text => {
                    document.querySelector('#aoc-part2-display').innerHTML = text;
                });

            loadFile(`../years/${year}/day${day}/input.txt`)
                .then(text => {
                    document.querySelector('#aoc-input').value = text;
                });
        } 

        window.addEventListener('load', () => {
            // generate options for dropdown menus
            const yearRange = [2015, 2020];
            const dayRange = [1, 25];

            for (let year = yearRange[0]; year <= yearRange[1]; year++) {
                let option = document.createElement('option');
                option.value = year;
                option.innerHTML = year;
                document.querySelector('#aoc-year').appendChild(option);
            }

            for (let day = dayRange[0]; day <= dayRange[1]; day++) {
                let option = document.createElement('option');
                option.value = day;
                option.innerHTML = day;
                document.querySelector('#aoc-day').appendChild(option);
            }

            // get form results for searching
            const form = document.querySelector('#aoc-search');
            form.addEventListener('submit', event => {
                event.preventDefault();

                let year = form.elements['year'].value;
                let day = form.elements['day'].value;

                loadPage(year, day);
            });

            document.querySelector('#aoc-run').addEventListener('click', () => {
                eval(
                    document.querySelector('#aoc-part1-display').innerHTML
                        .replace('module.exports', 'let aocPart1')
                        .replace(/&gt;/g, '>')
                        .replace(/&lt;/g, '<') +
                    `\ndocument.querySelector('#aoc-part1-answer').innerHTML = aocPart1(\`${document.querySelector('#aoc-input').value}\`);`
                );

                eval(
                    document.querySelector('#aoc-part2-display').innerHTML
                        .replace('module.exports', 'let aocPart2')
                        .replace(/&gt;/g, '>')
                        .replace(/&lt;/g, '<') +
                    `\ndocument.querySelector('#aoc-part2-answer').innerHTML = aocPart2(\`${document.querySelector('#aoc-input').value}\`);`
                );
            }, false);
        }, false);
    </script>
</body>

</html>